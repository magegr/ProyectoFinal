{% extends 'base.html.twig' %}

{% block title %}Usuarios{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>

        .title {
            font-weight: 700;
        }
        .table thead th {
            white-space: nowrap;
        }
        .opacidad {
            opacity: .75;
            font-size: .925rem;
        }
        .role {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

    </style>
{% endblock %}

{% block body %}
    <main class="container py-4">
        <header class="d-flex flex-wrap align-items-center justify-content-between mb-3">
            <div>

                <h1 class="h3 mb-1 title">Usuarios</h1>
                <a href="{{ path('app_main') }}"
                   class="btn btn-link text-decoration-none"
                   aria-label="Volver al menu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                        <path fill-rule="evenodd" d="M15 8a.5.5 0 0 1-.5.5H3.707l3.147 3.146a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L3.707 7.5H14.5A.5.5 0 0 1 15 8z"/>
                    </svg>
                    <span class="visually-hidden">Back to menu</span>
                </a>
                <p class="mb-0 text-body-secondary">Listado de usuarios registrados</p>

            </div>

            <nav class="d-flex gap-2">

                <a class="btn btn-primary" href="{{ path('app_user_new') }}">
                    Crear usuario
                </a>
            </nav>
        </header>

        <section class="shadow-sm">
            <div class="p-3 rounded-3 bg-white">
                <div class="table-responsive">
                    <table class="table table-hover align-center mb-0">
                        <thead class="table-light">
                        <tr class="text-center">
                            <th>Email</th>
                            <th>Roles</th>
                            <th>Nombre</th>
                            <th>Apellido 1</th>
                            <th>Apellido 2</th>
                            <th>Teléfono</th>
                            <th>Activo</th>
                            <th>Creado</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                        </thead>

                        <tbody class="text-center">
                        {% for user in users %}
                            <tr>

                                <td class="text-start">
                                    <span class="fw-semibold">{{ user.email }}</span>
                                </td>

                                <td>
                                    {% set roles = user.roles ?? [] %}
                                    {% if roles is empty %}
                                        <span class="text-body-secondary">Sin roles</span>
                                    {% else %}
                                        {% for r in roles %}
                                            <span class="badge text-bg-secondary role me-1">{{ r }}</span>
                                        {% endfor %}
                                    {% endif %}
                                </td>

                                <td>{{ user.name }}</td>

                                <td>
                                    {{ user.surname1 }}
                                </td>
                                <td>
                                    {{ user.surname2 ?? '-' }}
                                </td>

                                <td class="opacidad">
                                    {{ user.phone ?? '-' }}
                                </td>

                                <td>
                                    {% if user.active %}
                                        <span class="badge text-bg-success">Sí</span>
                                    {% else %}
                                        <span class="badge text-bg-danger">No</span>
                                    {% endif %}
                                </td>

                                <td class="opacidad">
                                    {{ user.createdAt ? user.createdAt|date('Y-m-d H:i') : '—' }}
                                </td>

                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-secondary"
                                       href="{{ path('app_user_show', {'id': user.id}) }}">
                                        Ver
                                    </a>
                                    <a class="btn btn-sm btn-outline-primary"
                                       href="{{ path('app_user_edit', {'id': user.id}) }}">
                                        Editar
                                    </a>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="9" class="text-center py-4 text-body-secondary">
                                    No hay usuarios.
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>
{% endblock %}
